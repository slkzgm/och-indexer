# =============================================================================
# GAME EVENTS SCHEMA
# =============================================================================
# This schema defines events and entities for OCH season 2
# featuring heroes, weapons, crafting, and various game mechanics.

# =============================================================================
# BLACKSMITH EVENTS
# =============================================================================
# Events related to weapon maintenance and enhancement

"""
Event triggered when a weapon is repaired at the blacksmith
"""
type Blacksmith_WeaponRepaired {
  id: ID!
  weaponId: BigInt!
  amount: BigInt! # Amount paid for repair
}

"""
Event triggered when a weapon is sharpened at the blacksmith
"""
type Blacksmith_WeaponSharpened {
  id: ID!
  weaponId: BigInt!
  amount: BigInt! # Amount paid for sharpening
}

# =============================================================================
# DRAGMA UNDERLINGS EVENTS
# =============================================================================
# Events related to hero staking and reward claiming system

"""
Event triggered when a user claims rewards from staked heroes
"""
type DragmaUnderlings_Claimed {
  id: ID!
  user: String! # User's wallet address
  heroId: BigInt!
  amount: BigInt! # Amount of rewards claimed
}

"""
Event triggered when a hero is staked for earning rewards
"""
type DragmaUnderlings_Staked {
  id: ID!
  user: String! # User's wallet address
  heroId: BigInt!
}

"""
Event triggered when a hero is unstaked from the rewards system
"""
type DragmaUnderlings_Unstaked {
  id: ID!
  user: String! # User's wallet address
  heroId: BigInt!
}

"""
Event triggered when a weapon's durability is updated during gameplay
"""
type DragmaUnderlings_WeaponDurabilityUpdated {
  id: ID!
  user: String! # User's wallet address
  weaponId: BigInt!
  oldDurability: BigInt!
  newDurability: BigInt!
}

"""
Event triggered when a weapon's sharpness is updated during gameplay
"""
type DragmaUnderlings_WeaponSharpnessUpdated {
  id: ID!
  user: String! # User's wallet address
  weaponId: BigInt!
  oldSharpness: BigInt!
  newSharpness: BigInt!
}

# =============================================================================
# GACHA EVENTS (ERC1155)
# =============================================================================
# Events related to gacha token transfers and management

"""
Event for batch transfers of gacha tokens (ERC1155)
"""
type Gacha1155_TransferBatch {
  id: ID!
  operator: String! # Address performing the transfer
  from: String! # Sender address
  to: String! # Recipient address
  ids: [BigInt!]! # Array of token IDs transferred
  amounts: [BigInt!]! # Array of amounts for each token ID
}

"""
Event for single transfer of gacha tokens (ERC1155)
"""
type Gacha1155_TransferSingle {
  id: ID!
  operator: String! # Address performing the transfer
  from: String! # Sender address
  to: String! # Recipient address
  event_id: BigInt! # Token ID being transferred
  amount: BigInt! # Amount transferred
}

# =============================================================================
# GACHA WEAPON MACHINE EVENTS
# =============================================================================
# Events related to weapon generation from gacha tokens

"""
Event triggered when a weapon is generated from gacha machine
"""
type GachaWeaponMachine_WeaponGenerated {
  id: ID!
  user: String! # User's wallet address
  weaponId: BigInt!
  metadata: BigInt! # Weapon metadata/attributes
  requestId: BigInt! # Links to the original request
}

"""
Event triggered when a weapon generation is requested from gacha machine
"""
type GachaWeaponMachine_WeaponRequested {
  id: ID!
  user: String! # User's wallet address
  tokenId: BigInt! # Gacha token ID used
  qty: BigInt! # Quantity of weapons requested
  requestId: BigInt! # Unique request identifier
}

# =============================================================================
# GYM EVENTS
# =============================================================================
# Events related to hero training and level upgrades

"""
Event triggered when a hero is upgraded using chaos upgrade method
"""
type Gym_ChaosUpgraded {
  id: ID!
  owner: String! # Hero owner's wallet address
  heroId: BigInt!
  season: BigInt! # Current game season
  oldLevel: BigInt!
  newLevel: BigInt!
  chances: [BigInt!]! # Success chances for each level attempt
}

"""
Event triggered when a hero is upgraded using normal upgrade method
"""
type Gym_NormalUpgraded {
  id: ID!
  owner: String! # Hero owner's wallet address
  heroId: BigInt!
  season: BigInt! # Current game season
  oldLevel: BigInt!
  newLevel: BigInt!
}

"""
Event triggered when a hero is upgraded using unknown upgrade method
"""
type Gym_UnknownUpgraded {
  id: ID!
  owner: String! # Hero owner's wallet address
  heroId: BigInt!
  season: BigInt! # Current game season
  oldLevel: BigInt!
  newLevel: BigInt!
  chances: [BigInt!]! # Success chances for each level attempt
}

"""
Event triggered when a hero upgrade is requested
"""
type Gym_UpgradeRequested {
  id: ID!
  season: BigInt! # Current game season
  owner: String! # Hero owner's wallet address
  heroId: BigInt!
  levelUp: BigInt! # Number of levels to upgrade
  cost: BigInt! # Total cost for the upgrade
}

# =============================================================================
# HERO TOKEN EVENTS (ERC20 & ERC721)
# =============================================================================
# Events related to hero token transfers

"""
Event for Hero ERC20 token transfers
"""
type Hero20_Transfer {
  id: ID!
  from: String! # Sender address
  to: String! # Recipient address
  amount: BigInt! # Amount transferred
}

"""
Event for consecutive Hero NFT transfers (ERC721)
"""
type Hero721_ConsecutiveTransfer {
  id: ID!
  fromTokenId: BigInt! # Starting token ID
  toTokenId: BigInt! # Ending token ID
  from: String! # Sender address
  to: String! # Recipient address
}

"""
Event for single Hero NFT transfer (ERC721)
"""
type Hero721_Transfer {
  id: ID!
  from: String! # Sender address
  to: String! # Recipient address
  tokenId: BigInt! # Hero token ID
}

# =============================================================================
# HERO ARMORY EVENTS
# =============================================================================
# Events related to weapon equipment system

"""
Event triggered when a weapon is equipped to a hero
"""
type HeroArmory_Equipped {
  id: ID!
  heroId: BigInt!
  weaponId: BigInt!
}

"""
Event triggered when a weapon is unequipped from a hero
"""
type HeroArmory_Unequipped {
  id: ID!
  heroId: BigInt!
  weaponId: BigInt!
}

# =============================================================================
# HERO WEAPON MACHINE EVENTS
# =============================================================================
# Events related to weapon generation from hero machine

"""
Event triggered when a weapon is generated from hero machine
"""
type HeroWeaponMachine_WeaponGenerated {
  id: ID!
  user: String! # User's wallet address
  weaponId: BigInt!
  metadata: BigInt! # Weapon metadata/attributes
  requestId: BigInt! # Links to the original request
}

"""
Event triggered when a weapon generation is requested from hero machine
"""
type HeroWeaponMachine_WeaponRequested {
  id: ID!
  user: String! # User's wallet address
  slot: BigInt! # Equipment slot for the weapon
  qty: BigInt! # Quantity of weapons requested
  amount: BigInt! # Total cost paid
  requestId: BigInt! # Unique request identifier
}

# =============================================================================
# WEAPON TOKEN EVENTS (ERC721)
# =============================================================================
# Events related to weapon NFT transfers and generation

"""
Event for consecutive Weapon NFT transfers (ERC721)
"""
type Weapon721_ConsecutiveTransfer {
  id: ID!
  fromTokenId: BigInt! # Starting token ID
  toTokenId: BigInt! # Ending token ID
  from: String! # Sender address
  to: String! # Recipient address
}

"""
Event for single Weapon NFT transfer (ERC721)
"""
type Weapon721_Transfer {
  id: ID!
  from: String! # Sender address
  to: String! # Recipient address
  tokenId: BigInt! # Weapon token ID
}

"""
Event triggered when weapons are generated/minted
"""
type Weapon721_WeaponGenerated {
  id: ID!
  to: String! # Recipient address
  qty: BigInt! # Quantity of weapons generated
}

"""
Event triggered when weapon metadata is generated
"""
type Weapon721_WeaponMetadataGenerated {
  id: ID!
  event_id: BigInt! # Token ID
  metadata: BigInt! # Weapon metadata/attributes
}

# =============================================================================
# WEAPON REMIXER EVENTS
# =============================================================================
# Events related to weapon mixing/combining system

"""
Event triggered when a legendary weapon mix is requested
"""
type WeaponRemixer_LegendaryMixRequested {
  id: ID!
  weaponIds: [BigInt!]! # Array of weapon IDs to be mixed
  cost: BigInt! # Total cost for the mix
  rarity: BigInt! # Target rarity level
  requestId: BigInt! # Unique request identifier
}

"""
Event triggered when a weapon is generated from remixer
"""
type WeaponRemixer_WeaponGenerated {
  id: ID!
  user: String! # User's wallet address
  weaponId: BigInt!
  metadata: BigInt! # Weapon metadata/attributes
  requestId: BigInt! # Links to the original request
}

"""
Event triggered when a weapon mix is requested
"""
type WeaponRemixer_WeaponMixRequested {
  id: ID!
  weaponIds: [BigInt!]! # Array of weapon IDs to be mixed
  cost: BigInt! # Total cost for the mix
  rarity: BigInt! # Target rarity level
  requestId: BigInt! # Unique request identifier
}

# =============================================================================
# ITEMS EVENTS (ERC1155)
# =============================================================================
# Events related to game items transfers

"""
Event for single transfer of game items (ERC1155)
"""
type Items_TransferSingle {
  id: ID!
  operator: String! # Address performing the transfer
  from: String! # Sender address
  to: String! # Recipient address
  event_id: BigInt! # Item ID being transferred
  amount: BigInt! # Amount transferred
}

"""
Event for batch transfers of game items (ERC1155)
"""
type Items_TransferBatch {
  id: ID!
  operator: String! # Address performing the transfer
  from: String! # Sender address
  to: String! # Recipient address
  ids: [BigInt!]! # Array of item IDs transferred
  amounts: [BigInt!]! # Array of amounts for each item ID
}

# =============================================================================
# FISHING EVENTS
# =============================================================================
# Events related to fishing mini-game mechanics

"""
Event triggered when a hero is staked for fishing
"""
type Fishing_Staked {
  id: ID!
  owner: String! # Hero owner's wallet address
  heroId: BigInt!
  zone: BigInt! # Fishing zone identifier (0-3)
  fee: BigInt! # Staking fee paid
}

"""
Event triggered when a fishing unstake is requested
"""
type Fishing_UnstakeRequested {
  id: ID!
  owner: String! # Hero owner's wallet address
  heroId: BigInt!
  requestId: BigInt! # Unique request identifier
}

"""
Event triggered when a hero is unstaked from fishing
"""
type Fishing_Unstaked {
  id: ID!
  owner: String! # Hero owner's wallet address
  heroId: BigInt!
  requestId: BigInt! # Links to the original request
  zone: BigInt! # Fishing zone identifier (0-3)
  amount: BigInt! # Rewards earned
  weaponShardId: BigInt! # Weapon shard obtained
  bonusId: BigInt! # Bonus item obtained
}

# =============================================================================
# CORE GAME ENTITIES
# =============================================================================

"""
Player entity representing a game user and their overall stats
"""
type Player @entity {
  id: Bytes! # Player's wallet address

  balance: BigInt! # Player's token balance

  # Inventory counts
  heroCount: Int! @default(value: "0") # Total number of heroes owned
  weaponCount: Int! @default(value: "0") # Total number of weapons owned
  stakedHeroCount: Int! @default(value: "0") # Number of currently staked heroes
  heroesByLevel: [Int!]! @default(value: "[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]")

  # Gacha token balances: [bronze, silver, gold, rainbow] - fixed order
  gachaBalances: [BigInt!]! @default(value: "[0, 0, 0, 0]")
  
  # Game items balances: [tokenId1, tokenId2, ..., tokenId21] - mapped to indices [0, 1, ..., 20]
  itemsBalances: [BigInt!]! @default(value: "[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]")
  
  # Total spending across all game activities
  totalSpent: BigInt! @default(value: "0") # Total spent on training, fishing, remix, etc.

  # Relations
  heroes: [Hero!]! @derivedFrom(field: "owner") # All heroes owned by this player
  weapons: [Weapon!]! @derivedFrom(field: "owner") # All weapons owned by this player
}

"""
Hero entity representing a playable character NFT
"""
type Hero @entity {
  id: String! # Hero token ID
  owner: Player! # Player who owns this hero
  minter: Bytes! # Address that minted this hero
  mintedTimestamp: BigInt! # When this hero was minted

  # Character progression
  level: Int! @default(value: "1") # Current hero level
  lastTrainingTimestamp: BigInt! @default(value: "0") # Last time hero was trained
  nextTrainingCost: BigInt! @default(value: "0") # Cost for next training session
  nextTrainingAvailable: BigInt! @default(value: "0") # When next training is available
  
  revealed: Boolean! @default(value: false) # Whether hero attributes are revealed

  # Equipment and combat stats
  equippedWeapon: Weapon @oneToOne @index # Currently equipped weapon
  damage: BigInt! @default(value: "0") # Total damage output

  # Rewards calculation system (all values in wei - 1e18)
  maxHeroPerDay: BigInt! @default(value: "0") # Maximum possible rewards per day
  baseHeroPerDay: BigInt! @default(value: "0") # Guaranteed 80% of max rewards
  bonusHeroPerDay: BigInt! @default(value: "0") # Current sharpness bonus (0-20% of max)
  effectiveHeroPerDay: BigInt! @default(value: "0") # Total daily rewards (base + bonus + 50)
  
  # Hourly equivalents for convenience calculations
  maxHeroPerHour: BigInt! @default(value: "0") # maxHeroPerDay / 24
  effectiveHeroPerHour: BigInt! @default(value: "0") # effectiveHeroPerDay / 24

  # Staking system
  staked: Boolean! @default(value: false) # Whether hero is currently staked
  stakingType: StakingType # Type of staking (fishing, dragma, etc.)
  stakedTimestamp: BigInt! @default(value: "0") # When hero was staked
  unstakeAvailableTimestamp: BigInt! @default(value: "0") # When hero can be unstaked
  lastClaimTimestamp: BigInt! @default(value: "0") # Last time rewards were claimed
  totalRewardsClaimed: BigInt! @default(value: "0") # Total rewards claimed pour ce hero
  totalStakingDuration: BigInt! @default(value: "0") # Durée totale de staking (en secondes, cumulée sur tous stakes)
  totalStakes: Int! @default(value: "0") # Nombre total de stakes pour ce hero
  totalUnstakes: Int! @default(value: "0") # Nombre total d'unstakes
  totalClaims: Int! @default(value: "0") # Nombre total de claims
  activities: [Activity!]! @derivedFrom(field: "hero") # Historique des activities liées à ce hero
  totalFishingFees: BigInt! @default(value: "0")
  totalFishingRewards: BigInt! @default(value: "0")
  fishingRewardsPerZone: [BigInt!]! @default(value: "[0,0,0,0]")
  totalFishingShards: Int! @default(value: "0")
  fishingShardsPerZone: [Int!]! @default(value: "[0,0,0,0]")
  totalFishingBonuses: Int! @default(value: "0")
  fishingBonusesPerZone: [Int!]! @default(value: "[0,0,0,0]")
  totalFishingSessions: Int! @default(value: "0") # Stakes in fishing
  fishingSessionsPerZone: [Int!]! @default(value: "[0,0,0,0]")
  totalAttemptedTrainings: Int! @default(value: "0")
  totalSuccessfulTrainings: Int! @default(value: "0")
  totalFailedTrainings: Int! @default(value: "0")
  attemptedByType: [Int!]! @default(value: "[0,0,0]")
  successfulByType: [Int!]! @default(value: "[0,0,0]")
  failedByType: [Int!]! @default(value: "[0,0,0]")
  totalOutcomeSumByType: [BigInt!]! @default(value: "[0,0,0]")
  outcomesCountByType: [[Int!]!]! @default(value: "[[0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0]]")
  sumOfChancesByType: [[BigInt!]!]! @default(value: "[[0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0]]")
  chancesCountByType: [Int!]! @default(value: "[0,0,0]")
  totalSpent: BigInt! @default(value: "0")
  spentByType: [BigInt!]! @default(value: "[0,0,0]")
  totalTrainingCost: BigInt! @default(value: "0")
  trainingCostByType: [BigInt!]! @default(value: "[0,0,0]")
}

# =============================================================================
# ENUMERATIONS
# =============================================================================

"""
Defines the different sources from which weapons can be obtained
"""
enum WeaponSource {
  GACHA_MACHINE # Generated from gacha tokens
  HERO_MACHINE # Generated from hero machine
  REMIXER # Created by combining other weapons
  DIRECT_MINT # Directly minted (admin/special events)
}

"""
Defines the type of remix operation used to create a weapon
"""
enum RemixType {
  NORMAL # Standard weapon mixing
  LEGENDARY # Legendary weapon mixing (higher cost/rarity)
}

"""
Weapon request tracking entity for managing asynchronous weapon generation
"""
type WeaponRequest @entity {
  id: String! # Request ID from blockchain event
  
  # Source and basic info
  source: WeaponSource! # Where this weapon request originated
  requester: Bytes! # Address that made the request
  timestamp: BigInt! # When request was made
  
  # Gacha machine specific fields
  gachaTokenId: BigInt # Gacha token ID used (for stats tracking)
  gachaQty: Int # Quantity requested from gacha
  
  # Hero machine specific fields
  heroSlot: BigInt # Equipment slot for hero machine
  heroQty: Int # Quantity requested from hero machine
  heroCost: BigInt # Total cost paid
  heroCostPerWeapon: BigInt # Calculated cost per weapon (cost/qty)
  
  # Remixer specific fields
  remixedWeaponIds: [BigInt!] # IDs of weapons that were burned/consumed
  remixRarity: Int # Target rarity for remix
  remixType: RemixType # Type of remix (normal/legendary)
  remixCost: BigInt # Cost for remix requests
  
  # Request tracking
  expectedWeapons: Int! # Number of weapons expected to be generated
  generatedWeapons: Int! @default(value: "0") # Counter of weapons actually generated
  completed: Boolean! @default(value: false) # Whether request is fully completed
  
  # Relations
  generatedWeaponIds: [String!]! # IDs of weapons generated from this request
}

"""
Weapon entity representing a weapon NFT with all its attributes
"""
type Weapon @entity {
  id: String! # Weapon token ID
  owner: Player! # Player who owns this weapon
  source: WeaponSource! # How this weapon was obtained
  rarity: Int! # 0=COMMON, 1=UNCOMMON, 2=RARE, 3=EPIC, 4=HEROIC, 5=LEGENDARY, 6=MYTHIC
  minter: Bytes! # Address that minted this weapon
  mintedTimestamp: BigInt! # When this weapon was minted

  # Equipment status
  equipped: Boolean! @default(value: false) # Whether weapon is currently equipped
  equippedHeroId: String # ID of hero that has this weapon equipped (null if not equipped)
  equippedBy: [Hero!]! @derivedFrom(field: "equippedWeapon") # Hero relation

  # Weapon attributes
  weaponType: Int! # Type/category of weapon
  sharpness: Int! # Current sharpness level (affects damage)
  maxSharpness: Int! # Maximum sharpness this weapon can achieve
  durability: Int! # Current durability (affects usage)
  maxDurability: Int! # Maximum durability this weapon can have
  broken: Boolean! @default(value: false) # Whether weapon is broken (0 durability)

  # Source tracking for analytics
  requestId: String # Link to WeaponRequest (null for DIRECT_MINT)
  
  # Gacha-specific tracking
  sourceGachaTokenId: BigInt # Gacha token ID used if source = GACHA_MACHINE
  
  # Hero machine-specific tracking
  sourceHeroCost: BigInt # Cost paid if source = HERO_MACHINE
  
  # Remixer-specific tracking
  sourceRemixedWeaponIds: [BigInt!] # IDs of weapons consumed if source = REMIXER
  sourceRemixRarity: Int # Target rarity if source = REMIXER
  sourceRemixType: RemixType # Type of remix if source = REMIXER
}

"""
Defines the different types of gacha tokens available
"""
enum GachaType {
  BRONZE # Bronze gacha tokens (lowest tier)
  SILVER # Silver gacha tokens
  GOLD # Gold gacha tokens
  RAINBOW # Rainbow gacha tokens (highest tier)
}

"""
Defines the different types of staking mechanisms available
"""
enum StakingType {
  DRAGMA_UNDERLINGS # Standard hero staking for rewards
  FISHING_SLIME_BAY # Fishing in Slime Bay zone (zone 0)
  FISHING_SHROOM_GROTTO # Fishing in Shroom Grotto zone (zone 1)
  FISHING_SKEET_PIER # Fishing in Skeet Pier zone (zone 2)
  FISHING_MAGMA_MIRE # Fishing in Magma Mire zone (zone 3)
}

"""
Defines the different types of training methods available
"""
enum TrainingType {
  NORMAL
  CHAOS
  UNKNOWN
}

# =============================================================================
# STATS & METRICS ENTITIES
# =============================================================================

type DragmaGlobalStats @entity {
  id: ID! # Singleton: 'global'
  totalStakedHeroes: Int! @default(value: "0")
  currentStakedHeroes: Int! @default(value: "0")
  totalUnstakedHeroes: Int! @default(value: "0")
  totalRewardsClaimed: BigInt! @default(value: "0")
  totalClaims: Int! @default(value: "0")
  averageClaimAmount: BigInt! @default(value: "0") # Calculé: totalRewards / totalClaims
  heroesByLevel: [Int!]! @default(value: "[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]")
  lastUpdated: BigInt! @default(value: "0")
}
type DragmaUserStats @entity {
  id: Bytes! # User address
  stakedHeroes: Int! @default(value: "0")
  currentStakedHeroes: Int! @default(value: "0")
  totalStakes: Int! @default(value: "0")
  totalUnstakes: Int! @default(value: "0")
  totalRewardsClaimed: BigInt! @default(value: "0")
  totalClaims: Int! @default(value: "0")
  averageStakingDuration: BigInt! @default(value: "0") # En secondes, moyenne
  heroesByLevel: [Int!]! @default(value: "[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]")
  player: Player! # Relation vers Player
}
type FishingGlobalStats @entity {
  id: ID! # 'global'
  totalHeroes: Int! @default(value: "0")
  totalHeroesPerZone: [Int!]! @default(value: "[0,0,0,0]") # [zone0,1,2,3]
  heroesByLevel: [Int!]! @default(value: "[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]")
  totalFeesPerZone: [BigInt!]! @default(value: "[0,0,0,0]")
  totalRewardsAmount: BigInt! @default(value: "0")
  rewardsPerZone: [BigInt!]! @default(value: "[0,0,0,0]")
  totalShardsWon: Int! @default(value: "0")
  shardsPerZone: [Int!]! @default(value: "[0,0,0,0]")
  totalBonuses: Int! @default(value: "0")
  bonusesPerZone: [Int!]! @default(value: "[0,0,0,0]")
  lastUpdated: BigInt! @default(value: "0")
}
type FishingUserStats @entity {
  id: Bytes! # User address
  totalHeroes: Int! @default(value: "0")
  heroesPerZone: [Int!]! @default(value: "[0,0,0,0]")
  heroesByLevel: [Int!]! @default(value: "[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]")
  totalFees: BigInt! @default(value: "0")
  feesPerZone: [BigInt!]! @default(value: "[0,0,0,0]")
  totalRewardsAmount: BigInt! @default(value: "0")
  rewardsPerZone: [BigInt!]! @default(value: "[0,0,0,0]")
  totalShardsWon: Int! @default(value: "0")
  shardsPerZone: [Int!]! @default(value: "[0,0,0,0]")
  totalBonuses: Int! @default(value: "0")
  bonusesPerZone: [Int!]! @default(value: "[0,0,0,0]")
  totalSessionsPerZone: [Int!]! @default(value: "[0,0,0,0]")
  player: Player!
}

type GymGlobalStats @entity {
  id: ID! # 'global'
  totalAttemptedTrainings: Int! @default(value: "0")
  totalSuccessfulTrainings: Int! @default(value: "0")
  totalFailedTrainings: Int! @default(value: "0")
  attemptedByType: [Int!]! @default(value: "[0,0,0]")
  successfulByType: [Int!]! @default(value: "[0,0,0]")
  failedByType: [Int!]! @default(value: "[0,0,0]")
  totalOutcomeSumByType: [BigInt!]! @default(value: "[0,0,0]")
  outcomesCountByType: [[Int!]!]! @default(value: "[[0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0]]")
  sumOfChancesByType: [[BigInt!]!]! @default(value: "[[0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0]]")
  chancesCountByType: [Int!]! @default(value: "[0,0,0]")
  totalSpent: BigInt! @default(value: "0")
  spentByType: [BigInt!]! @default(value: "[0,0,0]")
  lastUpdated: BigInt! @default(value: "0")
}

type GymUserStats @entity {
  id: Bytes! # User address
  totalAttemptedTrainings: Int! @default(value: "0")
  totalSuccessfulTrainings: Int! @default(value: "0")
  totalFailedTrainings: Int! @default(value: "0")
  attemptedByType: [Int!]! @default(value: "[0,0,0]")
  successfulByType: [Int!]! @default(value: "[0,0,0]")
  failedByType: [Int!]! @default(value: "[0,0,0]")
  totalOutcomeSumByType: [BigInt!]! @default(value: "[0,0,0]")
  outcomesCountByType: [[Int!]!]! @default(value: "[[0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0]]")
  sumOfChancesByType: [[BigInt!]!]! @default(value: "[[0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0]]")
  chancesCountByType: [Int!]! @default(value: "[0,0,0]")
  totalSpent: BigInt! @default(value: "0")
  spentByType: [BigInt!]! @default(value: "[0,0,0]")
  player: Player!
}

enum RemixOutcome {
  FAIL # +0 tier
  SUCCESS # +1 tier
  PERFECT # +2 tier
}

type RemixGlobalStats @entity {
  id: ID! # 'global'
  totalRemixes: BigInt! @default(value: "0")
  remixesByNumWeapons: [BigInt!]! @default(value: "[0,0,0,0]")
  totalSpent: BigInt! @default(value: "0")
  spentByNumWeapons: [BigInt!]! @default(value: "[0,0,0,0]")
  outcomesByTypeAndRarity: [[[BigInt!]!]!]! @default(value: "[[[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0]], [[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0]], [[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0]], [[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0]]]") 
  lastUpdated: BigInt! @default(value: "0")
}

type RemixUserStats @entity {
  id: Bytes! # User address
  totalRemixes: BigInt! @default(value: "0")
  remixesByNumWeapons: [BigInt!]! @default(value: "[0,0,0,0]")
  totalSpent: BigInt! @default(value: "0")
  spentByNumWeapons: [BigInt!]! @default(value: "[0,0,0,0]")
  outcomesByTypeAndRarity: [[[BigInt!]!]!]! @default(value: "[[[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0]], [[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0]], [[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0]], [[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0]]]") 
  player: Player!
}

"""
Entité pour feed d'activité unifié (extensible à tous contrats)
"""
type Activity @entity {
  id: ID! # Format: chainId_block_logIndex
  timestamp: BigInt!
  user: Bytes! # Address impliquée
  eventType: String! # Ex: 'STAKE', 'UNSTAKE', 'CLAIM', etc.
  details: String! # JSON stringifié pour détails (ex: {heroId: 123, amount: 456})
  contract: String! # Ex: 'DragmaUnderlings'
  heroId: String # Optionnel, pour filters per hero (ID du hero impliqué)
  hero: Hero @index # Relation vers le hero (optionnel, basé sur heroId)
  stakingType: StakingType # Optionnel, pour différencier types/zones de staking
}

# Ajout d'une entité globale pour les stats des héros
type HeroesGlobalStats @entity {
  id: ID! # 'global'
  totalHeroes: Int! @default(value: "0") # Nombre total de héros existants
  totalMinted: Int! @default(value: "0") # Cumulatif des héros mintés
  totalBurned: Int! @default(value: "0") # Cumulatif des héros burnés
  heroesByLevel: [Int!]! @default(value: "[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]") # Distribution par level (0-100)
  lastUpdated: BigInt! @default(value: "0")
}
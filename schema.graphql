# =================================================================================================
# Entities for tracking player assets and statistics.
# This schema is designed for a "nerd platform" to provide deep insights into the game economy.
# We pre-calculate as many stats as possible during indexing to ensure fast query performance.
# All entity IDs are Strings as required by the framework.
# =================================================================================================

# -------------------------------------------------------------------------------------------------
# Player Entity: Represents a user and aggregates their assets and statistics.
# -------------------------------------------------------------------------------------------------
type Player @entity {
  "Wallet address, used as the unique ID."
  id: String!

  "Player's ERC20 token balance."
  balance: BigInt! @default(value: "0")

  tokenIn: BigInt! @default(value: "0")
  tokenOut: BigInt! @default(value: "0")
  tokenTransferEventsIn: BigInt! @default(value: "0")
  tokenTransferEventsOut: BigInt! @default(value: "0")

  "Heroes (ERC721) owned by this player. Derived from the 'owner' field on the Hero entity."
  heroes: [Hero!]! @derivedFrom(field: "owner")

  heroesCount: BigInt! @default(value: "0")
  totalHeroesLevel: BigInt! @default(value: "0")
  heroTransfersIn: BigInt! @default(value: "0")
  heroTransfersOut: BigInt! @default(value: "0")
  heroesAverageLevel: BigInt! @default(value: "0")
  heroCountByLevel: [BigInt!]! @default(value: "[]")

  "Weapons (ERC721) owned by this player. Derived from the 'owner' field on the Weapon entity."
  weapons: [Weapon!]! @derivedFrom(field: "owner")

  "Gacha items (ERC1155) balances for this player. This is a join table."
  gachaBalances: [GachaBalance!]! @derivedFrom(field: "player")

  totalClaimed: BigInt! @default(value: "0")
  totalStaked: BigInt! @default(value: "0")
  totalUnstaked: BigInt! @default(value: "0")

  # --- Aggregate Training Statistics (for all heroes) ---
  totalTrainings: BigInt! @default(value: "0")
  totalTrainingCost: BigInt! @default(value: "0")
  totalLevelGains: BigInt! @default(value: "0")

  # --- Per-Type Training Statistics (for all heroes) ---
  normalTrainingCost: BigInt! @default(value: "0")
  chaosTrainingCost: BigInt! @default(value: "0")
  unknownTrainingCost: BigInt! @default(value: "0")
  
  normalTrainingsCount: BigInt! @default(value: "0")
  chaosTrainingsCount: BigInt! @default(value: "0")
  unknownTrainingsCount: BigInt! @default(value: "0")

  normalLevelGains: BigInt! @default(value: "0")
  chaosLevelGains: BigInt! @default(value: "0")
  unknownLevelGains: BigInt! @default(value: "0")
  chaosLevelGainsDistribution: [BigInt!]! @default(value: "[]")
  unknownLevelGainsDistribution: [BigInt!]! @default(value: "[]")

  # --- Chance Statistics for Averaging (Player-level, per type) ---
  chaosChancesSum: [BigInt!]! @default(value: "[]")
  unknownChancesSum: [BigInt!]! @default(value: "[]")

  "Full history of training sessions initiated by this player."
  trainingHistory: [Training!]! @derivedFrom(field: "player")

  # --- Mint/Burn Statistics ---
  heroesMinted: BigInt! @default(value: "0")
  heroesBurned: BigInt! @default(value: "0")
  weaponsMinted: BigInt! @default(value: "0")
  weaponsBurned: BigInt! @default(value: "0")
  gachaMinted: BigInt! @default(value: "0")
  gachaBurned: BigInt! @default(value: "0")
  gachaTransfersIn: BigInt! @default(value: "0")
  gachaTransfersOut: BigInt! @default(value: "0")
  
  # --- Gacha Mint/Burn Statistics (by type) ---
  bronzeGachasMinted: BigInt! @default(value: "0")
  bronzeGachasBurned: BigInt! @default(value: "0")
  bronzeGachaTransfersIn: BigInt! @default(value: "0")
  bronzeGachaTransfersOut: BigInt! @default(value: "0")
  silverGachasMinted: BigInt! @default(value: "0")
  silverGachasBurned: BigInt! @default(value: "0")
  silverGachaTransfersIn: BigInt! @default(value: "0")
  silverGachaTransfersOut: BigInt! @default(value: "0")
  goldGachasMinted: BigInt! @default(value: "0")
  goldGachasBurned: BigInt! @default(value: "0")
  goldGachaTransfersIn: BigInt! @default(value: "0")
  goldGachaTransfersOut: BigInt! @default(value: "0")
  rainbowGachasMinted: BigInt! @default(value: "0")
  rainbowGachasBurned: BigInt! @default(value: "0")
  rainbowGachaTransfersIn: BigInt! @default(value: "0")
  rainbowGachaTransfersOut: BigInt! @default(value: "0")

  weaponsCount: BigInt! @default(value: "0")
  weaponTransfersIn: BigInt! @default(value: "0")
  weaponTransfersOut: BigInt! @default(value: "0")
  weaponsMintedByRarity: [BigInt!]! @default(value: "[]")
  weaponsBurnedByRarity: [BigInt!]! @default(value: "[]")
  weaponsMintedBySharpness: [BigInt!]! @default(value: "[]")
  weaponsBurnedBySharpness: [BigInt!]! @default(value: "[]")
  weaponsOwnedByRarity: [BigInt!]! @default(value: "[0,0,0,0,0,0,0]")

  # --- Remixer Stats ---
  remixerStats: [PlayerRemixerStatsByRarity!]! @derivedFrom(field: "player")
  totalRemixes: BigInt! @default(value: "0")
  totalRemixCost: BigInt! @default(value: "0")
  totalRemixSuccesses: BigInt! @default(value: "0")
  totalRemixFailures: BigInt! @default(value: "0")
  totalRemixBigSuccesses: BigInt! @default(value: "0")

  weaponsSacrificedToRemixer: BigInt! @default(value: "0")
  weaponsSacrificedToRemixerByRarity: [BigInt!]! @default(value: "[0,0,0,0,0,0,0]")
  weaponsGeneratedFromRemixer: BigInt! @default(value: "0")
  weaponsGeneratedFromRemixerByRarity: [BigInt!]! @default(value: "[0,0,0,0,0,0,0]")

  gachaStats: [PlayerGachaStat!]! @derivedFrom(field: "player")
  weaponsMintedFromGachaByRarity: [BigInt!]! @default(value: "[0,0,0,0,0,0,0]")

  # --- Hero Weapon Machine Stats ---
  hero20SpentOnWeapons: BigInt! @default(value: "0")
  weaponsMintedFromHeroMachine: BigInt! @default(value: "0")
  weaponsMintedFromHeroMachineByRarity: [BigInt!]! @default(value: "[0,0,0,0,0,0,0]")

  # --- Direct Mint Stats ---
  weaponsMintedFromDirectMint: BigInt! @default(value: "0")
  weaponsMintedFromDirectMintByRarity: [BigInt!]! @default(value: "[0,0,0,0,0,0,0]")
  
  "The sum of the next training cost for all heroes owned by the player."
  totalNextTrainingCost: BigInt! @default(value: "0")

  # --- Armory Stats ---
  "The number of heroes owned by the player that have a weapon equipped."
  equippedHeroesCount: BigInt! @default(value: "0")
  "The sum of the damage of all equipped heroes owned by the player."
  totalEquippedDamage: BigInt! @default(value: "0")
  "The sum of the damage of all equipped heroes owned by the player, broken down by weapon rarity."
  totalEquippedDamageByWeaponRarity: [BigInt!]! @default(value: "[0,0,0,0,0,0,0]")
  "The distribution of equipped weapons by rarity for this player."
  equippedHeroesCountByWeaponRarity: [BigInt!]! @default(value: "[0,0,0,0,0,0,0]")
  "Detailed armory stats by hero level."
  armoryStatsByLevel: [PlayerArmoryStatsByLevel!]! @derivedFrom(field: "player")

  # --- Blacksmith Stats ---
  totalRepairs: BigInt! @default(value: "0")
  totalRepairCost: BigInt! @default(value: "0")
  totalSharpens: BigInt! @default(value: "0")
  totalSharpenCost: BigInt! @default(value: "0")
  repairsByRarity: [BigInt!]! @default(value: "[0,0,0,0,0,0,0]")
  repairCostByRarity: [BigInt!]! @default(value: "[0,0,0,0,0,0,0]")
  sharpensByRarity: [BigInt!]! @default(value: "[0,0,0,0,0,0,0]")
  sharpenCostByRarity: [BigInt!]! @default(value: "[0,0,0,0,0,0,0]")

  # --- Staking Stats ---
  stakedHeroesCount: BigInt! @default(value: "0")
  stakingCount: BigInt! @default(value: "0")
  totalDailyReward: BigInt! @default(value: "0")
  totalHourlyReward: BigInt! @default(value: "0")
  stakingTotalClaimed: BigInt! @default(value: "0")
  totalStakedTime: BigInt! @default(value: "0")
  stakedHeroesCountByLevel: [BigInt!]! @default(value: "[]")
  stakedHeroesCountByWeaponRarity: [BigInt!]! @default(value: "[0,0,0,0,0,0,0]")
  stakingStatsByLevelAndRarity: [PlayerStakingStatsByLevelAndRarity!]! @derivedFrom(field: "player")
}


# -------------------------------------------------------------------------------------------------
# Asset Entities: Represent the core NFTs in the game (Heroes and Weapons).
# -------------------------------------------------------------------------------------------------
type Hero @entity {
  "Token ID of the Hero NFT, used as the unique ID."
  id: String!

  "The current owner of the Hero. If null, the hero is burned or in a non-tracked contract."
  owner: Player

  "The player who originally minted this Hero."
  minter: Player!

  "Timestamp of when this Hero was minted."
  mintedTimestamp: BigInt!

  "Current level of the hero."
  level: BigInt! @default(value: "1")

  "Timestamp of the last successful training."
  lastTrainedTimestamp: BigInt! @default(value: "0")

  "Timestamp of when the hero will be available for training again."
  nextTrainingAvailableTimestamp: BigInt! @default(value: "0")

  "Cost of the next training session for this hero."
  nextTrainingCost: BigInt! @default(value: "0")

  "The current damage of the hero, based on its level and equipped weapon."
  damage: BigInt! @default(value: "0")

  "The weapon currently equipped by this hero."
  equippedWeapon: Weapon @oneToOne

  "Total amount of tokens claimed by this player."
  totalClaimed: BigInt! @default(value: "0")
  totalStaked: BigInt! @default(value: "0")
  totalUnstaked: BigInt! @default(value: "0")

  # --- Aggregate Training Statistics (for this hero) ---
  totalTrainings: BigInt! @default(value: "0")
  totalTrainingCost: BigInt! @default(value: "0")
  totalLevelGains: BigInt! @default(value: "0")

  # --- Per-Type Training Statistics (for this hero) ---
  normalTrainingCost: BigInt! @default(value: "0")
  chaosTrainingCost: BigInt! @default(value: "0")
  unknownTrainingCost: BigInt! @default(value: "0")

  normalTrainingsCount: BigInt! @default(value: "0")
  chaosTrainingsCount: BigInt! @default(value: "0")
  unknownTrainingsCount: BigInt! @default(value: "0")

  normalLevelGains: BigInt! @default(value: "0")
  chaosLevelGains: BigInt! @default(value: "0")
  unknownLevelGains: BigInt! @default(value: "0")
  chaosLevelGainsDistribution: [BigInt!]! @default(value: "[]")
  unknownLevelGainsDistribution: [BigInt!]! @default(value: "[]")

  # --- Chance Statistics for Averaging (Hero-level, per type) ---
  chaosChancesSum: [BigInt!]! @default(value: "[]")
  unknownChancesSum: [BigInt!]! @default(value: "[]")

  "Full history of training sessions for this specific hero."
  trainingHistory: [Training!]! @derivedFrom(field: "hero")

  transferCount: BigInt! @default(value: "0")

  # --- Staking Stats ---
  staked: Boolean! @default(value: false)
  stakingType: StakingType
  stakedTimestamp: BigInt! @default(value: "0")
  unstakeAvailableTimestamp: BigInt! @default(value: "0")
  lastClaimTimestamp: BigInt! @default(value: "0")
  totalStakedTime: BigInt! @default(value: "0")
  stakingCount: BigInt! @default(value: "0")
  
  "The base $HERO per day from staking."
  baseHeroPerDay: BigInt! @default(value: "0")
  "The bonus $HERO per day from staking, based on sharpness."
  bonusHeroPerDay: BigInt! @default(value: "0")
  "The total effective $HERO per day from staking."
  dailyReward: BigInt! @default(value: "0")
  "The total effective $HERO per hour from staking."
  hourlyReward: BigInt! @default(value: "0")
  "Total amount of $HERO claimed from staking this hero."
  stakingTotalClaimed: BigInt! @default(value: "0")
}

enum WeaponRarity {
  Common
  Uncommon
  Rare
  Epic
  Heroic
  Legendary
  Mythic
}

enum WeaponOrigin {
  GACHA_MACHINE,
  WEAPON_MACHINE,
  REMIXER,
  DIRECT_MINT
}

type Weapon @entity {
  "Token ID of the Weapon NFT, used as the unique ID."
  id: String!

  "The hero who has this weapon equipped."
  equippedBy: Hero @oneToOne

  "The current owner of the Weapon. If null, the weapon is burned or in a non-tracked contract."
  owner: Player

  "The origin of the weapon."
  origin: WeaponOrigin!

  "If origin is GACHA_MACHINE, this specifies the type of Gacha."
  gachaType: GachaType

  "The player who originally minted this Weapon."
  minter: Player!

  "The rarity of the weapon."
  rarity: WeaponRarity!

  "Timestamp of when this Weapon was minted."
  mintedTimestamp: BigInt!

  transferCount: BigInt! @default(value: "0")

  "Durability of the weapon."
  durability: BigInt!
  maxDurability: BigInt!
  repairedCount: BigInt! @default(value: "0")
  repairSpent: BigInt! @default(value: "0")

  "Sharpness of the weapon."
  sharpness: BigInt!
  maxSharpness: BigInt!
  sharpenedCount: BigInt! @default(value: "0")
  sharpenSpent: BigInt! @default(value: "0")

  # --- Staking Stats ---
  totalStakedHeroesCount: BigInt! @default(value: "0")
  playersWithStakedHeroesCount: BigInt! @default(value: "0")
  totalStakingCount: BigInt! @default(value: "0")
  grandTotalDailyReward: BigInt! @default(value: "0")
  grandTotalHourlyReward: BigInt! @default(value: "0")
  grandTotalClaimedFromStaking: BigInt! @default(value: "0")
  grandTotalStakedTime: BigInt! @default(value: "0")
  totalStakedHeroesCountByLevel: [BigInt!]! @default(value: "[]")
  totalStakedHeroesCountByWeaponRarity: [BigInt!]! @default(value: "[0,0,0,0,0,0,0]")
}


# -------------------------------------------------------------------------------------------------
# Gacha Entities: For tracking ERC1155 assets.
# -------------------------------------------------------------------------------------------------
type GachaItem @entity {
  "Token ID of the Gacha Item (ERC1155), used as the unique ID."
  id: String!

  "Balances of this item across all players."
  balances: [GachaBalance!]! @derivedFrom(field: "item")

  transferCount: BigInt! @default(value: "0")
}

type GachaBalance @entity {
  "Composite ID: playerAddress-gachaItemId"
  id: String!

  "The player who owns these items."
  player: Player!

  "The Gacha Item being tracked."
  item: GachaItem!

  "The quantity of this item owned by the player."
  balance: BigInt!
}


# -------------------------------------------------------------------------------------------------
# History Entity: Logs individual events for detailed analysis.
# -------------------------------------------------------------------------------------------------
enum TrainingType {
  Normal
  Chaos
  Unknown
}

type Training @entity {
  "Transaction hash + log index, to uniquely identify the training event."
  id: String!

  "The player who initiated the training."
  player: Player!

  "The hero that was trained."
  hero: Hero!

  "The type of training session."
  trainingType: TrainingType!

  "The cost of the training session in ERC20 tokens."
  cost: BigInt!

  "The number of levels gained in this session."
  levelGain: BigInt!

  "The chances array, if applicable (for Chaos/Unknown types)."
  chances: [BigInt!]

  "Timestamp of the block where the training occurred."
  timestamp: BigInt!
}


# -------------------------------------------------------------------------------------------------
# Global Singleton Entity: Aggregates game-wide statistics.
# -------------------------------------------------------------------------------------------------
type GlobalStats @entity(immutable: false) {
  "Singleton ID, always 'global'. There will only ever be one instance of this entity."
  id: String!

  # --- Entity Counts ---
  playerCount: BigInt! @default(value: "0")
  heroesCount: BigInt! @default(value: "0")
  totalHeroesLevel: BigInt! @default(value: "0")
  weaponsCount: BigInt! @default(value: "0")
  gachasCount: BigInt! @default(value: "0")
  bronzeGachasCount: BigInt! @default(value: "0")
  silverGachasCount: BigInt! @default(value: "0")
  goldGachasCount: BigInt! @default(value: "0")
  rainbowGachasCount: BigInt! @default(value: "0")
  heroCountByLevel: [BigInt!]! @default(value: "[]")

  # --- Transfer Counts ---
  totalTokenTransfers: BigInt! @default(value: "0")
  totalHeroTransfers: BigInt! @default(value: "0")
  totalWeaponTransfers: BigInt! @default(value: "0")
  totalGachaTransfers: BigInt! @default(value: "0")
  totalBronzeGachaTransfers: BigInt! @default(value: "0")
  totalSilverGachaTransfers: BigInt! @default(value: "0")
  totalGoldGachaTransfers: BigInt! @default(value: "0")
  totalRainbowGachaTransfers: BigInt! @default(value: "0")

  # --- Mint/Burn Statistics ---
  totalHeroesMinted: BigInt! @default(value: "0")
  totalHeroesBurned: BigInt! @default(value: "0")
  totalWeaponsMinted: BigInt! @default(value: "0")
  totalWeaponsBurned: BigInt! @default(value: "0")
  totalGachasMinted: BigInt! @default(value: "0")
  totalGachasBurned: BigInt! @default(value: "0")
  totalBronzeGachasMinted: BigInt! @default(value: "0")
  totalBronzeGachasBurned: BigInt! @default(value: "0")
  totalSilverGachasMinted: BigInt! @default(value: "0")
  totalSilverGachasBurned: BigInt! @default(value: "0")
  totalGoldGachasMinted: BigInt! @default(value: "0")
  totalGoldGachasBurned: BigInt! @default(value: "0")
  totalRainbowGachasMinted: BigInt! @default(value: "0")
  totalRainbowGachasBurned: BigInt! @default(value: "0")
  totalWeaponsMintedByRarity: [BigInt!]! @default(value: "[]")
  totalWeaponsBurnedByRarity: [BigInt!]! @default(value: "[]")
  totalWeaponsMintedBySharpness: [BigInt!]! @default(value: "[]")
  totalWeaponsBurnedBySharpness: [BigInt!]! @default(value: "[]")

  # --- Staking / Claiming ---
  totalClaimed: BigInt! @default(value: "0")
  totalStaked: BigInt! @default(value: "0")
  totalUnstaked: BigInt! @default(value: "0")

  # --- Training Statistics ---
  totalTrainings: BigInt! @default(value: "0")
  totalTrainingCost: BigInt! @default(value: "0")
  totalLevelGains: BigInt! @default(value: "0")
  totalNormalTrainingsCount: BigInt! @default(value: "0")
  totalChaosTrainingsCount: BigInt! @default(value: "0")
  totalUnknownTrainingsCount: BigInt! @default(value: "0")
  totalNormalTrainingCost: BigInt! @default(value: "0")
  totalChaosTrainingCost: BigInt! @default(value: "0")
  totalUnknownTrainingCost: BigInt! @default(value: "0")
  totalNormalLevelGains: BigInt! @default(value: "0")
  totalChaosLevelGains: BigInt! @default(value: "0")
  totalUnknownLevelGains: BigInt! @default(value: "0")
  totalChaosLevelGainsDistribution: [BigInt!]! @default(value: "[]")
  totalUnknownLevelGainsDistribution: [BigInt!]! @default(value: "[]")
  totalChaosChancesSum: [BigInt!]! @default(value: "[]")
  totalUnknownChancesSum: [BigInt!]! @default(value: "[]")

  # --- Remixer Stats ---
  totalRemixes: BigInt! @default(value: "0")
  totalRemixCost: BigInt! @default(value: "0")
  totalRemixSuccesses: BigInt! @default(value: "0")
  totalRemixFailures: BigInt! @default(value: "0")
  totalRemixBigSuccesses: BigInt! @default(value: "0")

  weaponsSacrificedToRemixer: BigInt! @default(value: "0")
  weaponsSacrificedToRemixerByRarity: [BigInt!]! @default(value: "[0,0,0,0,0,0,0]")
  weaponsGeneratedFromRemixer: BigInt! @default(value: "0")
  weaponsGeneratedFromRemixerByRarity: [BigInt!]! @default(value: "[0,0,0,0,0,0,0]")

  "Total number of weapons generated by players."
  totalWeaponsGenerated: BigInt! @default(value: "0")

  "Distribution of weapons generated by rarity."
  weaponsGeneratedByRarity: [BigInt!]! @default(value: "[0,0,0,0,0,0,0]")

  "Distribution of weapons generated by sharpness."
  weaponsGeneratedBySharpness: [BigInt!]! @default(value: "[0,0,0,0,0,0,0,0,0,0,0]")

  "Current distribution of all weapons in circulation by rarity."
  totalWeaponsOwnedByRarity: [BigInt!]! @default(value: "[0,0,0,0,0,0,0]")

  "Stats for the Remixer, aggregated by rarity."
  remixerStats: [GlobalRemixerStatsByRarity!]! @derivedFrom(field: "global")

  gachaStats: [GlobalGachaStat!]! @derivedFrom(field: "global")

  # --- Hero Weapon Machine Stats ---
  totalHero20SpentOnWeapons: BigInt! @default(value: "0")
  totalWeaponsMintedFromHeroMachine: BigInt! @default(value: "0")
  totalWeaponsMintedFromHeroMachineByRarity: [BigInt!]! @default(value: "[0,0,0,0,0,0,0]")

  # --- Direct Mint Stats ---
  totalWeaponsMintedFromDirectMint: BigInt! @default(value: "0")
  totalWeaponsMintedFromDirectMintByRarity: [BigInt!]! @default(value: "[0,0,0,0,0,0,0]")

  totalWeaponsSacrificedToRemixer: BigInt! @default(value: "0")
  totalWeaponsSacrificedToRemixerByRarity: [BigInt!]! @default(value: "[0,0,0,0,0,0,0]")
  totalWeaponsGeneratedFromRemixer: BigInt! @default(value: "0")
  totalWeaponsGeneratedFromRemixerByRarity: [BigInt!]! @default(value: "[0,0,0,0,0,0,0]")

  # --- Armory Stats ---
  "The total number of heroes that have a weapon equipped."
  totalEquippedHeroesCount: BigInt! @default(value: "0")
  "The sum of the damage of all equipped heroes in the game."
  grandTotalEquippedDamage: BigInt! @default(value: "0")
  "The sum of the damage of all equipped heroes in the game, broken down by weapon rarity."
  grandTotalEquippedDamageByWeaponRarity: [BigInt!]! @default(value: "[0,0,0,0,0,0,0]")
  "The distribution of equipped weapons by rarity across all players."
  totalEquippedHeroesCountByWeaponRarity: [BigInt!]! @default(value: "[0,0,0,0,0,0,0]")
  "Detailed armory stats by hero level across all players."
  armoryStatsByLevel: [GlobalArmoryStatsByLevel!]! @derivedFrom(field: "global")

  # --- Blacksmith Stats ---
  totalRepairs: BigInt! @default(value: "0")
  totalRepairCost: BigInt! @default(value: "0")
  totalSharpens: BigInt! @default(value: "0")
  totalSharpenCost: BigInt! @default(value: "0")
  repairsByRarity: [BigInt!]! @default(value: "[0,0,0,0,0,0,0]")
  repairCostByRarity: [BigInt!]! @default(value: "[0,0,0,0,0,0,0]")
  sharpensByRarity: [BigInt!]! @default(value: "[0,0,0,0,0,0,0]")
  sharpenCostByRarity: [BigInt!]! @default(value: "[0,0,0,0,0,0,0]")

  # --- Staking Stats ---
  totalStakedHeroesCount: BigInt! @default(value: "0")
  playersWithStakedHeroesCount: BigInt! @default(value: "0")
  totalStakingCount: BigInt! @default(value: "0")
  grandTotalDailyReward: BigInt! @default(value: "0")
  grandTotalHourlyReward: BigInt! @default(value: "0")
  grandTotalClaimedFromStaking: BigInt! @default(value: "0")
  grandTotalStakedTime: BigInt! @default(value: "0")
  totalStakedHeroesCountByLevel: [BigInt!]! @default(value: "[]")
  totalStakedHeroesCountByWeaponRarity: [BigInt!]! @default(value: "[0,0,0,0,0,0,0]")
  stakingStatsByLevelAndRarity: [GlobalStakingStatsByLevelAndRarity!]! @derivedFrom(field: "global")
}

type Blacksmith_WeaponRepaired {
  id: ID!
  weaponId: BigInt!
  amount: BigInt!
  oldSharpness: BigInt!
  newSharpness: BigInt!
  count: BigInt! @default(value: "0")
}

type Blacksmith_WeaponSharpened {
  id: ID!
  weaponId: BigInt!
  amount: BigInt!
}

type DragmaUnderlings_Claimed {
  id: ID!
  user: String!
  heroId: BigInt!
  amount: BigInt!
}

type DragmaUnderlings_Staked {
  id: ID!
  user: String!
  heroId: BigInt!
}

type DragmaUnderlings_Unstaked {
  id: ID!
  user: String!
  heroId: BigInt!
}

type DragmaUnderlings_WeaponDurabilityUpdated {
  id: ID!
  user: String!
  weaponId: BigInt!
  oldDurability: BigInt!
  newDurability: BigInt!
}

type DragmaUnderlings_WeaponSharpnessUpdated {
  id: ID!
  user: String!
  weaponId: BigInt!
  oldSharpness: BigInt!
  newSharpness: BigInt!
}

type Gacha1155_TransferBatch {
  id: ID!
  operator: String!
  from: String!
  to: String!
  ids: [BigInt!]!
  amounts: [BigInt!]!
}

type Gacha1155_TransferSingle {
  id: ID!
  operator: String!
  from: String!
  to: String!
  event_id: BigInt!
  amount: BigInt!
}

type GachaWeaponMachine_WeaponGenerated {
  id: ID!
  user: String!
  weaponId: BigInt!
  metadata: BigInt!
  requestId: BigInt!
}

type GachaWeaponMachine_WeaponRequested {
  id: ID!
  user: String!
  tokenId: BigInt!
  qty: BigInt!
  requestId: BigInt!
}

type Gym_ChaosUpgraded {
  id: ID!
  owner: String!
  heroId: BigInt!
  season: BigInt!
  oldLevel: BigInt!
  newLevel: BigInt!
  chances: [BigInt!]!
}

type Gym_NormalUpgraded {
  id: ID!
  owner: String!
  heroId: BigInt!
  season: BigInt!
  oldLevel: BigInt!
  newLevel: BigInt!
}

type Gym_UnknownUpgraded {
  id: ID!
  owner: String!
  heroId: BigInt!
  season: BigInt!
  oldLevel: BigInt!
  newLevel: BigInt!
  chances: [BigInt!]!
}

type Gym_UpgradeRequested {
  id: ID!
  season: BigInt!
  owner: String!
  heroId: BigInt!
  levelUp: BigInt!
  cost: BigInt!
}

type Hero20_Transfer {
  id: ID!
  from: String!
  to: String!
  amount: BigInt!
}

type Hero721_ConsecutiveTransfer {
  id: ID!
  fromTokenId: BigInt!
  toTokenId: BigInt!
  from: String!
  to: String!
}

type Hero721_Transfer {
  id: ID!
  from: String!
  to: String!
  tokenId: BigInt!
}

type HeroArmory_Equipped {
  id: ID!
  heroId: BigInt!
  weaponId: BigInt!
}

type HeroArmory_Unequipped {
  id: ID!
  heroId: BigInt!
  weaponId: BigInt!
}

type HeroWeaponMachine_WeaponGenerated {
  id: ID!
  user: String!
  weaponId: BigInt!
  metadata: BigInt!
  requestId: BigInt!
}

type HeroWeaponMachine_WeaponRequested {
  id: ID!
  user: String!
  slot: BigInt!
  qty: BigInt!
  amount: BigInt!
  requestId: BigInt!
}

type Weapon721_ConsecutiveTransfer {
  id: ID!
  fromTokenId: BigInt!
  toTokenId: BigInt!
  from: String!
  to: String!
}

type Weapon721_Transfer {
  id: ID!
  from: String!
  to: String!
  tokenId: BigInt!
}

type Weapon721_WeaponGenerated {
  id: ID!
  to: String!
  qty: BigInt!
}

type Weapon721_WeaponMetadataGenerated {
  id: ID!
  event_id: BigInt!
  metadata: BigInt!
}

type WeaponRemixer_LegendaryMixRequested {
  id: ID!
  weaponIds: [BigInt!]!
  cost: BigInt!
  rarity: BigInt!
  requestId: BigInt!
}

type WeaponRemixer_WeaponGenerated {
  id: ID!
  user: String!
  weaponId: BigInt!
  metadata: BigInt!
  requestId: BigInt!
}

type WeaponRemixer_WeaponMixRequested {
  id: ID!
  weaponIds: [BigInt!]!
  cost: BigInt!
  rarity: BigInt!
  requestId: BigInt!
}

# -------------------------------------------------------------------------------------------------
# Temp & Analytics Entities: For handling complex logic and detailed stats.
# -------------------------------------------------------------------------------------------------

type WeaponMintRequest @entity {
  "The requestId of the event, links Request to Generation."
  id: String!
  player: Player!
  origin: WeaponOrigin!
  qty: BigInt
  generatedCount: BigInt! @default(value: "0")
  gachaRaritySource: BigInt
  cost: BigInt
  remixRarity: WeaponRarity
  remixIsLegendary: Boolean
  remixAmount: BigInt
}

type PlayerRemixerStatsByRarity @entity {
  "ID: player.id-rarity"
  id: String!
  player: Player!
  rarity: WeaponRarity!
  totalRemixes: BigInt! @default(value: "0")
  totalCost: BigInt! @default(value: "0")
  successCount: BigInt! @default(value: "0")
  failureCount: BigInt! @default(value: "0")
  bigSuccessCount: BigInt! @default(value: "0")
  "Indexed by (amount - REMIXER_AMOUNT_MIN). Stores total remixes for 2, 3, 4, 5 items."
  remixesByAmount: [BigInt!]! @default(value: "[]")
  "Indexed by (amount - REMIXER_AMOUNT_MIN). Stores successes for 2, 3, 4, 5 items."
  successesByAmount: [BigInt!]! @default(value: "[]")
  "Indexed by (amount - REMIXER_AMOUNT_MIN). Stores failures for 2, 3, 4, 5 items."
  failuresByAmount: [BigInt!]! @default(value: "[]")
}

type GlobalRemixerStatsByRarity @entity {
  "ID: rarity enum value (e.g., 'Common')"
  id: String!
  global: GlobalStats!
  rarity: WeaponRarity!
  totalRemixes: BigInt! @default(value: "0")
  totalCost: BigInt! @default(value: "0")
  successCount: BigInt! @default(value: "0")
  failureCount: BigInt! @default(value: "0")
  bigSuccessCount: BigInt! @default(value: "0")
  remixesByAmount: [BigInt!]! @default(value: "[]")
  successesByAmount: [BigInt!]! @default(value: "[]")
  failuresByAmount: [BigInt!]! @default(value: "[]")
}

# =================================================================================================
# Gacha-specific statistics for players and globally.
# =================================================================================================

enum GachaType {
  Bronze
  Silver
  Gold
  Rainbow
}

type PlayerGachaStat @entity {
  "ID: {player_id}-{gacha_type}"
  id: String!
  player: Player!
  gachaType: GachaType!
  totalOpened: BigInt! @default(value: "0")
  countsByRarity: [BigInt!]! @default(value: "[0,0,0,0,0,0,0]") # Common -> Mythic
}

type GlobalGachaStat @entity {
  "ID: {gacha_type}"
  id: String!
  global: GlobalStats!
  gachaType: GachaType!
  totalOpened: BigInt! @default(value: "0")
  countsByRarity: [BigInt!]! @default(value: "[0,0,0,0,0,0,0]") # Common -> Mythic
}

type PlayerArmoryStatsByLevel @entity {
  "ID: {player_id}-{level}"
  id: String!
  player: Player!
  level: Int!
  "Number of heroes at this level with a weapon equipped."
  equippedHeroesCount: BigInt! @default(value: "0")
  "Sum of damage for heroes at this level."
  totalDamage: BigInt! @default(value: "0")
  "Distribution of equipped weapons by rarity for heroes at this level."
  equippedCountByRarity: [BigInt!]! @default(value: "[0,0,0,0,0,0,0]")
}

type GlobalArmoryStatsByLevel @entity {
  "ID: {level}"
  id: String!
  global: GlobalStats!
  level: Int!
  "Number of heroes at this level with a weapon equipped."
  equippedHeroesCount: BigInt! @default(value: "0")
  "Sum of damage for heroes at this level."
  totalDamage: BigInt! @default(value: "0")
  "Distribution of equipped weapons by rarity for heroes at this level."
  equippedCountByRarity: [BigInt!]! @default(value: "[0,0,0,0,0,0,0]")
}

enum StakingType {
  Dragma
}

type PlayerStakingStatsByLevelAndRarity @entity {
  "ID: {player_id}-{level}-{rarity}"
  id: String!
  player: Player!
  level: Int!
  rarity: WeaponRarity!
  count: BigInt! @default(value: "0")
}

type GlobalStakingStatsByLevelAndRarity @entity {
  "ID: {level}-{rarity}"
  id: String!
  global: GlobalStats!
  level: Int!
  rarity: WeaponRarity!
  count: BigInt! @default(value: "0")
}